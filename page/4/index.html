<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Originally
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

<link rel="alternate" href="/atom.xml" title="Originally" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/timg.png" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Originally</a></h1>
      <div id="subtitle-box">
        
          <span id="subtitle">Make excellence a habit</span>
        
      </div>
      <div>
        
        <img
          src="/images/001.jpg"
          class="cover-logo"
          alt="Originally"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-yzm" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/24/yzm/"
    >自定义图片验证码</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/24/yzm/" class="article-date">
  <time datetime="2020-04-24T10:20:10.000Z" itemprop="datePublished">2020-04-24</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h4 id="首先我们需要用到一下库"><a href="#首先我们需要用到一下库" class="headerlink" title="首先我们需要用到一下库"></a>首先我们需要用到一下库</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绘画库</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> ImageDraw</span><br><span class="line"><span class="comment">#图片库</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="comment">#随机库</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#文件流</span></span><br><span class="line"><span class="keyword">import</span> io</span><br></pre></td></tr></table></figure>
<h4 id="后台代码如下"><a href="#后台代码如下" class="headerlink" title="后台代码如下"></a>后台代码如下</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义图片验证码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCode</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义rgb随机颜色</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_random_color</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        R = random.randrange(<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">        G = random.randrange(<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">        B = random.randrange(<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (R,G,B)</span><br><span class="line">    <span class="comment"># 定义图片视图</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,reuqest)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 画布</span></span><br><span class="line">        img_size = (<span class="number">120</span>,<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 定义图片对象</span></span><br><span class="line">        image = Image.new(<span class="string">'RGB'</span>,img_size,<span class="string">'white'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 定义画笔</span></span><br><span class="line">        draw = ImageDraw.Draw(image,<span class="string">'RGB'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 随机字母</span></span><br><span class="line">        source = <span class="string">'1256453534&amp;32qwertyyuiycvbnbdsf'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 接收容器</span></span><br><span class="line">        code_str = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 进入循环绘制</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 获取字母颜色</span></span><br><span class="line">            text_color = self.get_random_color()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 获取随机下标</span></span><br><span class="line">            tmp_num = random.randrange(len(source))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 随机字符串</span></span><br><span class="line">            random_str = source[tmp_num]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 装入容器中</span></span><br><span class="line">            code_str += random_str</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 绘制字符串</span></span><br><span class="line">            draw.text((<span class="number">10</span>+<span class="number">30</span>*i,<span class="number">20</span>),random_str,text_color)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取缓存区</span></span><br><span class="line">        buf = io.BytesIO()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 临时图图片保存在缓冲</span></span><br><span class="line">        image.save(buf,<span class="string">'png'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(buf.getvalue(),<span class="string">'image/png'</span>)</span><br></pre></td></tr></table></figure>
<p> 简单的验证码绘制完成</p>
<h3 id="在前端的操作"><a href="#在前端的操作" class="headerlink" title="在前端的操作"></a>在前端的操作</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>首先我们需要的input文本</span><br><span class="line"></span><br><span class="line">    &lt;td&gt;</span><br><span class="line">        验证码：&lt;input type=<span class="string">"text"</span> v-model=<span class="string">"code"</span>&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line"></span><br><span class="line">    注：我们需要双向绑定一个code 这个code作为验证码的信息传给后端</span><br></pre></td></tr></table></figure>

<h3 id="获取后台的验证码的地址"><a href="#获取后台的验证码的地址" class="headerlink" title="获取后台的验证码的地址"></a>获取后台的验证码的地址</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'code/'</span>,MyCode.as_view()) <span class="comment">#这是我们设定路由为code 运行django项目 进入这个路由 导航栏的地址 ctrl+c</span></span><br></pre></td></tr></table></figure>

<h3 id="之后前端验证码进行展示"><a href="#之后前端验证码进行展示" class="headerlink" title="之后前端验证码进行展示"></a>之后前端验证码进行展示</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">首先我们需要个img标签来展示验证码    </span><br><span class="line"></span><br><span class="line">    &lt;img :src="src" alt="点击刷新" @click="changecode" class="imagecode"&gt;</span><br><span class="line"></span><br><span class="line">    注：用v-bind绑定,src代表地址，此时我们从后端复制的地址，则定义变量进行存储\</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">        code:<span class="string">''</span>, <span class="comment"># 验证码,</span></span><br><span class="line">        src:<span class="string">'http://127.0.0.1:8000/code/'</span>, <span class="comment"># 图片地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    就是这个样子</span><br></pre></td></tr></table></figure>

<h3 id="我们点击验证码的时候需要刷新-点一下刷新一下"><a href="#我们点击验证码的时候需要刷新-点一下刷新一下" class="headerlink" title="我们点击验证码的时候需要刷新 点一下刷新一下"></a>我们点击验证码的时候需要刷新 点一下刷新一下</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">1.</span>看见@click这个点击事件，所以我们在下面定义一个叫changecode的方法 用于点击刷新</span><br><span class="line">       </span><br><span class="line">       <span class="comment"># 点击刷新</span></span><br><span class="line">       changecode:function()&#123;</span><br><span class="line">           <span class="comment"># 生成随机数</span></span><br><span class="line">           var num = Math.ceil(Math.random()*<span class="number">100</span>)</span><br><span class="line">           <span class="comment"># 进行传参	</span></span><br><span class="line">           this.src = this.src + <span class="string">'?num ='</span>+num   <span class="comment"># 路由拼接</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="存储redis"><a href="#存储redis" class="headerlink" title="存储redis"></a>存储redis</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="comment"># 连接redis</span></span><br><span class="line">host = <span class="string">"localhost"</span> <span class="comment"># 本地端口</span></span><br><span class="line">port = <span class="number">6379</span> <span class="comment"># redis端口号</span></span><br><span class="line">r = redis.Redis(host=host,port=port) <span class="comment">#连接  </span></span><br><span class="line"><span class="comment"># 保存随机码</span></span><br><span class="line">r.set(<span class="string">'code'</span>,code_str)</span><br><span class="line"><span class="comment"># 读取则用 </span></span><br><span class="line">r.get(<span class="string">'code'</span>)</span><br><span class="line"></span><br><span class="line">ok廖！！</span><br></pre></td></tr></table></figure>

<h3 id="之后登陆就简单了"><a href="#之后登陆就简单了" class="headerlink" title="之后登陆就简单了"></a>之后登陆就简单了</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">code = request.GET.get(<span class="string">'code'</span>,<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 比对验证码</span></span><br><span class="line">redis_code = r.get(<span class="string">'code'</span>)</span><br><span class="line"><span class="comment"># 转码</span></span><br><span class="line">redis_code = redis_code.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># if贩判断</span></span><br><span class="line"><span class="keyword">if</span> code != redis_code:</span><br><span class="line">    <span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>:<span class="number">403</span>,<span class="string">'msg'</span>:<span class="string">"您输入的验证码有误"</span>&#125;)</span><br><span class="line"></span><br><span class="line">注：在这里有一个坑需要suo一下 我们必须进行转码操作，这样才能进行判断。</span><br><span class="line">    如果不进行转码，则无法比较，因为不转码 redis_code的值将会是二进制，所以decode一下。</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-python_md5" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/24/python_md5/"
    >MD5加密</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/24/python_md5/" class="article-date">
  <time datetime="2020-04-24T07:19:22.000Z" itemprop="datePublished">2020-04-24</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="MD5加密"><a href="#MD5加密" class="headerlink" title="MD5加密"></a>MD5加密</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入加密库</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># md5加密方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_password</span><span class="params">(mypass)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#转码操作</span></span><br><span class="line">    mypass_utf8 = str(mypass).encode(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密操作</span></span><br><span class="line">    md5.update(mypass_utf8)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#返回密文</span></span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br></pre></td></tr></table></figure>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-django_lg" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/23/django_lg/"
    >Django--模拟登陆注册</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/23/django_lg/" class="article-date">
  <time datetime="2020-04-23T02:53:23.000Z" itemprop="datePublished">2020-04-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="django-vue登陆注册"><a href="#django-vue登陆注册" class="headerlink" title="django+vue登陆注册"></a>django+vue登陆注册</h3><h4 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h4><p><strong>django后台做api</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    登陆接口，get和post方式</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(&#123;<span class="string">"code"</span>: <span class="number">404</span>&#125;))</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        info = request.POST</span><br><span class="line">        print(info)</span><br><span class="line">        <span class="comment"># 获取到数据以后，做逻辑判断，成功返回200，失败返回404</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(json.dumps(&#123;<span class="string">"code"</span>: <span class="number">200</span>&#125;))</span><br></pre></td></tr></table></figure>

<p><strong>使用axios做ajax–post提交数据</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line">    export default &#123;</span><br><span class="line">        // 获取用户名和密码框输入的内容，用字典的形式返回</span><br><span class="line">        data:function()&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                username: <span class="string">''</span>,</span><br><span class="line">                password: <span class="string">''</span>,</span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            </span><br><span class="line">            on_submit()&#123;</span><br><span class="line">                // 创建一个FormData()实例</span><br><span class="line">                let form_data = new FormData()</span><br><span class="line">                // Application/Json -&gt; request.POST(form-data)</span><br><span class="line">                // url: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/api/register</span><br><span class="line">                form_data.append(<span class="string">'username'</span>, this.username)                </span><br><span class="line">                form_data.append(<span class="string">'password'</span>, this.password)</span><br><span class="line">                // 使用axios用post方式提交数据</span><br><span class="line">                axios(&#123;</span><br><span class="line">                    method: <span class="string">'post'</span>,</span><br><span class="line">                    url: <span class="string">'http://127.0.0.1:8000/apilogin/api_login/'</span>,</span><br><span class="line">                    data: form_data</span><br><span class="line">                &#125;).then(function(res)&#123;</span><br><span class="line">                    // 成功以后，返回的内容</span><br><span class="line">                    console.log(res)</span><br><span class="line">                    // 成功以后，做页面跳转</span><br><span class="line">                &#125;).catch((error)=&gt;&#123;</span><br><span class="line">                    // 失败以后，返回的内容</span><br><span class="line">                    console.log(error)</span><br><span class="line">                    // 失败以后，停留在当前页面</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


<h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="comment">#导入加密库</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入数据库</span></span><br><span class="line"><span class="keyword">from</span> myapp.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="comment"># md5加密方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_password</span><span class="params">(mypass)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment">#转码操作</span></span><br><span class="line">    mypass_utf8 = str(mypass).encode(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="comment"># 加密操作</span></span><br><span class="line">    md5.update(mypass_utf8)</span><br><span class="line">    <span class="comment">#返回密文</span></span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册接口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span><span class="params">(APIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 接收参数</span></span><br><span class="line">        username = request.GET.get(<span class="string">'username'</span>,<span class="literal">None</span>)</span><br><span class="line">        password = request.GET.get(<span class="string">'password'</span>,<span class="literal">None</span>)</span><br><span class="line">        img = request.GET.get(<span class="string">'img'</span>,<span class="literal">None</span>)</span><br><span class="line">        type = request.GET.get(<span class="string">'type'</span>,<span class="literal">None</span>)</span><br><span class="line">        phone = request.GET.get(<span class="string">'phone'</span>,<span class="literal">None</span>)</span><br><span class="line">        num = request.GET.get(<span class="string">'num'</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># 排重操作</span></span><br><span class="line">        user = User.objects.filter(username=username).first()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>:<span class="number">403</span>,<span class="string">'msg'</span>:<span class="string">'该用户已经存在'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 入库</span></span><br><span class="line">        user = User(username=username,password=make_password(password),</span><br><span class="line">                    phone=phone,img=img,type=type,num=num</span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存结果</span></span><br><span class="line">        user.save()</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'code'</span>:<span class="number">200</span>,<span class="string">'msg'</span>:<span class="string">'注册成功'</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="脚本测试"><a href="#脚本测试" class="headerlink" title="脚本测试"></a>脚本测试</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://127.0.0.1:8000/register'</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">'username'</span>:<span class="string">'Amy'</span>,</span><br><span class="line">    <span class="string">'password'</span>:<span class="number">123</span>,</span><br><span class="line">    <span class="string">'img'</span>:<span class="string">'123123'</span>,</span><br><span class="line">    <span class="string">'num'</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">'type'</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">'phone'</span>:<span class="number">2212312312312312312213123133122</span>,</span><br><span class="line">&#125;</span><br><span class="line">res = requests.get(url=url, params=params)</span><br><span class="line">print(res.status_code)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<h4 id="清除pip缓存"><a href="#清除pip缓存" class="headerlink" title="清除pip缓存"></a>清除pip缓存</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">打开命令行</span><br><span class="line">cd pip</span><br><span class="line">然后删除此文件夹下的cache文件就可以清除了</span><br></pre></td></tr></table></figure>

<h4 id="生成反向解析表"><a href="#生成反向解析表" class="headerlink" title="生成反向解析表"></a>生成反向解析表</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python manage.py inspectdb &gt; mymodels.py</span><br></pre></td></tr></table></figure>



      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-gouwuche" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/22/gouwuche/"
    >简易购物车代码</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/22/gouwuche/" class="article-date">
  <time datetime="2020-04-22T07:19:53.000Z" itemprop="datePublished">2020-04-22</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="如下"><a href="#如下" class="headerlink" title="如下"></a>如下</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;名称&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;数量&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;价格&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr v-<span class="keyword">for</span>=<span class="string">"(itemone,indexone) in tlist "</span> :key=<span class="string">"indexone"</span>&gt;</span><br><span class="line">    &lt;td&gt;</span><br><span class="line">        &#123;&#123; itemone.text &#125;&#125;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line"></span><br><span class="line">    &lt;td&gt;</span><br><span class="line">        &lt;button @click="numchange(indexone,'-')" &gt;-&lt;/button&gt;</span><br><span class="line">            &#123;&#123;itemone.num&#125;&#125;</span><br><span class="line">        &lt;button @click="numchange(indexone,'+')"&gt;+&lt;/button&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line"></span><br><span class="line">    &lt;td&gt;</span><br><span class="line">        &#123;&#123; itemone.price &#125;&#125;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;/table&gt;</span><br><span class="line">    总价格:&#123;&#123; totalprice() &#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default&#123;</span><br><span class="line">// 定义数据</span><br><span class="line">    data()&#123;</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">    tlist:[&#123;text:<span class="string">'汽车'</span>,num:<span class="number">1</span>,<span class="string">'price'</span>:<span class="number">100</span>&#125;,&#123;text:<span class="string">'化妆品'</span>,num:<span class="number">1</span>,<span class="string">'price'</span>:<span class="number">100</span>,&#125;,&#123;text:<span class="string">'衣服'</span>,num:<span class="number">1</span>,<span class="string">'price'</span>:<span class="number">100</span>&#125;,&#123;text:<span class="string">'书籍'</span>,num:<span class="number">1</span>,<span class="string">'price'</span>:<span class="number">100</span>&#125;],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    //自定方法</span><br><span class="line">    methods:&#123;</span><br><span class="line">        // 计算总的价格 </span><br><span class="line">        totalprice:function()&#123;</span><br><span class="line">            let total =<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(var i=<span class="number">0</span>,l=this.tlist.length;i&lt;l;i++)&#123;</span><br><span class="line">                total += (this.tlist[i].num * this.tlist[i].price);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">return</span> total;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 自动清除操作</span><br><span class="line">        delete_one:function(indexone)&#123;</span><br><span class="line">            this.tlist.splice(indexone,<span class="number">1</span>);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // 购物车的加减操作</span><br><span class="line">        numchange:function(indexone,type)&#123;</span><br><span class="line">            <span class="keyword">if</span>(type==<span class="string">"+"</span>)&#123;</span><br><span class="line">            this.tlist[indexone].num ++</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (this.tlist[indexone].num &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    this.tlist[indexone].num --</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    this.delete_one(indexone);</span><br><span class="line">                    </span><br><span class="line">                &#125;	</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-hexo" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/21/hexo/"
    >如何使用Hexo创建博客</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/21/hexo/" class="article-date">
  <time datetime="2020-04-21T03:20:33.000Z" itemprop="datePublished">2020-04-21</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="什么是Hexo"><a href="#什么是Hexo" class="headerlink" title="什么是Hexo ?"></a>什么是Hexo ?</h3><p>Hexo 是一个快速、简洁且高效的博客框架。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>：安装hexo，在安装之前，需要安装的程序如下：</span><br><span class="line">    a): Node.js</span><br><span class="line">    b): Git</span><br><span class="line"><span class="number">2</span>: 安装hexo，打开终端，输入安装hexo命令：</span><br><span class="line">    npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h3 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>：安装Hexo之后，执行命令，Hexo会在指定文件夹中创建博客框架</span><br><span class="line">    hexo init &lt;blog&gt;</span><br><span class="line">    cd &lt;blog&gt;</span><br><span class="line"><span class="number">2</span>：新建完成后，目录如下：</span><br><span class="line">    _config.yml -&gt; 网站的 配置 信息，您可以在此配置大部分的参数。</span><br><span class="line">    package.json -&gt; 应用程序的信息。</span><br><span class="line">    scaffolds -&gt; 模版文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</span><br><span class="line">    source -&gt; 资源文件夹是存放用户资源的地方。除 _posts 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 public 文件夹，而其他文件会被拷贝过去。</span><br><span class="line">    themes -&gt; 主题文件夹。Hexo 会根据主题来生成静态页面。</span><br><span class="line"><span class="number">3</span>：启动服务器</span><br><span class="line"></span><br><span class="line">    hexo server <span class="comment">#即可浏览博客</span></span><br></pre></td></tr></table></figure>

<h3 id="部署到git"><a href="#部署到git" class="headerlink" title="部署到git"></a>部署到git</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>：安装 hexo-deployer-git</span><br><span class="line"></span><br><span class="line">    npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>



<h3 id="修改hexo配置-config"><a href="#修改hexo配置-config" class="headerlink" title="修改hexo配置 # _config"></a>修改hexo配置 # _config</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">url: https:&#x2F;&#x2F;lu_hao_nan.gitee.io</span><br><span class="line">root: &#x2F;</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">    type: git</span><br><span class="line">    repo: https:&#x2F;&#x2F;lu_hao_nan.gitee.io  # 库（Repository）地址</span><br><span class="line">    branch: master # 	分支名称</span><br></pre></td></tr></table></figure>



<h3 id="打包成public"><a href="#打包成public" class="headerlink" title="打包成public"></a>打包成public</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">hexo -clean</span><br><span class="line">hexo -d <span class="comment"># 开始部署</span></span><br><span class="line">hexo -g <span class="comment"># 生成新的public文件</span></span><br><span class="line"></span><br><span class="line">之后打包public远程推送到git上就点击服务gitee pages就可以启动啦！</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-gitix" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/20/gitix/"
    >什么是Git ?</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/20/gitix/" class="article-date">
  <time datetime="2020-04-19T18:10:22.000Z" itemprop="datePublished">2020-04-20</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>GIT，全称是分布式版本控制系统，git通常在编程中会用到，并且git支持分布式部署，可以有效、高速的处理从很小到非常大的项目版本管理。分布式相比于集中式的最大区别在于开发者可以提交到本地，每个开发者通过克隆（git clone），在本地机器上拷贝一个完整的Git仓库。</p>
<h3 id="git命令介绍"><a href="#git命令介绍" class="headerlink" title="git命令介绍"></a>git命令介绍</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">git clone 代码库的url</span><br><span class="line">将线上库克隆到本地</span><br><span class="line"></span><br><span class="line">git init</span><br><span class="line">初始化git</span><br><span class="line"></span><br><span class="line">git renote add origin (address) <span class="comment"># 仓库地址</span></span><br><span class="line">添加到远程仓库</span><br><span class="line"></span><br><span class="line">git add -A</span><br><span class="line">将工作区的修改提交到暂存区</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">'msg'</span></span><br><span class="line">将暂存区的文件或目录提交到版本库区</span><br><span class="line"></span><br><span class="line">git push origin master</span><br><span class="line">将提交到本地库中的内容推送到远程库中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看日志：git log</span><br><span class="line">回滚（本地）：git reset --hard 版本id  </span><br><span class="line">回滚（服务器）：git push HEAD --force  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git崩溃解决方法</span><br><span class="line"></span><br><span class="line">    <span class="number">1</span>):删除项目，全部重做</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span>):删除.git，清空仓库，重新链接库，重新上传文件</span><br></pre></td></tr></table></figure>





      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-mongoDB" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/20/mongoDB/"
    >mongoDB语法</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/20/mongoDB/" class="article-date">
  <time datetime="2020-04-19T18:10:02.000Z" itemprop="datePublished">2020-04-20</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h4 id="mongoDB"><a href="#mongoDB" class="headerlink" title="mongoDB"></a>mongoDB</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据库分为：关系型，非关系型</span><br><span class="line">关系型：Myspl，spllit</span><br><span class="line">非关系型：Redis，MongoDB</span><br><span class="line">主要区别：数据存储结构不同</span><br></pre></td></tr></table></figure>

<h4 id="库操作"><a href="#库操作" class="headerlink" title="库操作"></a>库操作</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查看：show dbs <span class="comment">#只能查看非空的库</span></span><br><span class="line">创库：use 库名</span><br><span class="line">新增：db.表名.insert(&#123;<span class="string">'key'</span>：<span class="string">'value'</span>&#125;)  <span class="comment">#如果给一个字典就添加一条，如果给一个列表就添加多条</span></span><br><span class="line">查看：db.表名.find(&#123;&#125;)  <span class="comment">#查看全部</span></span><br><span class="line">     show tables  <span class="comment">#查看库中所有的表</span></span><br><span class="line">     db  <span class="comment">#查看当前使用的库</span></span><br><span class="line">删除：db.表名.drop()  <span class="comment">#删表</span></span><br><span class="line">     db.dropDatabase()  <span class="comment">#删库</span></span><br></pre></td></tr></table></figure>



<h4 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#增：</span></span><br><span class="line">    新增：db.表名.insert(&#123;<span class="string">'key'</span>：<span class="string">'value'</span>&#125;)  <span class="comment">#如果给一个字典就添加一条，如果给一个列表就添加多条</span></span><br><span class="line">    插入一条：db.表名.insertOne(&#123;<span class="string">"key"</span>:<span class="string">'value'</span>&#125;)  <span class="comment">#给一个字典添加一条</span></span><br><span class="line">    插入多条：db.表名.insertMany([&#123;<span class="string">"key1"</span>:<span class="string">'value1'</span>&#125;,&#123;<span class="string">'key2'</span>,<span class="string">"value2"</span>&#125;])  <span class="comment">#给一个列表添加多条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查：条件中&#123;"_id":0&#125;意为不显示id</span></span><br><span class="line">    查看全部：db.表名.find(&#123;&#125;)  <span class="comment">#</span></span><br><span class="line">    排序：db.表名.find(&#123;&#125;).sort(&#123;<span class="string">"字段名"</span>:<span class="number">1</span>/<span class="number">-1</span>&#125;)  <span class="comment">#1代表升序 -1代表降序</span></span><br><span class="line">    分页：db.表名.find(&#123;&#125;).limit(个数)</span><br><span class="line">    等值查询：db.表名.find(&#123;<span class="string">"字段名"</span>:<span class="string">"value"</span>&#125;)</span><br><span class="line">    多值查询：db.表名.find(&#123;<span class="string">"字段名1"</span>:<span class="string">"value1"</span>，<span class="string">"字段名2"</span>:<span class="string">"value2"</span>&#125;)</span><br><span class="line">    包含查询：db.表名.find(&#123;$<span class="keyword">or</span>[&#123;<span class="string">"字段名1"</span>:<span class="string">"value1"</span>&#125;,&#123;<span class="string">"字段名2"</span>:<span class="string">"value2"</span>&#125;]&#125;)</span><br><span class="line">    非等值查询：db.表名.find(&#123;<span class="string">"字段名"</span>:&#123;条件：值&#125;&#125;)  <span class="comment">#大于$gt，小于$lt，大等$gte，小等$lte，不等$ne</span></span><br><span class="line">    正则查询(模糊查询)：db.表名.find(&#123;<span class="string">"字段名"</span>：&#123;$regex:<span class="string">"正则表达式"</span>&#125;&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#改</span></span><br><span class="line">    db.表名.update(&#123;<span class="string">"存在的key"</span>:<span class="string">"存在的value"</span>&#125;,&#123;<span class="string">"存在的key"</span>:<span class="string">"修改后的value"</span>&#125;)  <span class="comment">#只改第一个符合条件的</span></span><br><span class="line">    db.表名.update(&#123;<span class="string">"存在的key"</span>:<span class="string">"存在的value"</span>&#125;,&#123;$set&#123;<span class="string">"存在的key"</span>:<span class="string">"修改后的value"</span>&#125;&#125;)  <span class="comment">#只改第一个符合条件的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删</span></span><br><span class="line">    删除一条：db.表名.remove(&#123;<span class="string">"key"</span>:<span class="string">"value"</span>&#125;)</span><br><span class="line">    删除所有数据：db.表名.remove(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="python交互"><a href="#python交互" class="headerlink" title="python交互"></a>python交互</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">import</span> pymongo</span><br><span class="line">   conn = pymongo.MongoClient()</span><br><span class="line">   db = conn.库名</span><br><span class="line">   table = db.表名</span><br><span class="line">   <span class="comment">#增</span></span><br><span class="line">   table.insert(&#123;<span class="string">'key'</span>：<span class="string">'value'</span>&#125;) <span class="comment">#如果给一个字典就添加一条，如果给一个列表就添加多条</span></span><br><span class="line">   table.insert_one(&#123;<span class="string">'key'</span>：<span class="string">'value'</span>&#125;)  <span class="comment">#添加一条</span></span><br><span class="line">    teble.insertMany([&#123;<span class="string">"key1"</span>:<span class="string">'value1'</span>&#125;,&#123;<span class="string">'key2'</span>,<span class="string">"value2"</span>&#125;])  <span class="comment">#给一个列表添加多条</span></span><br><span class="line"><span class="comment">#查</span></span><br><span class="line">   table.find(&#123;&#125;)  <span class="comment">#返回的是一个mongo对象，可以用list强转或者for循环遍历</span></span><br><span class="line">   <span class="comment">#改</span></span><br><span class="line">   table.update_one(&#123;<span class="string">"key1"</span>:<span class="string">"value1"</span>&#125;,&#123;<span class="string">"key1"</span>:<span class="string">"value2"</span>&#125;)  <span class="comment">#修改</span></span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-django_orm" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/18/django_orm/"
    >Django--ORM操作</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/18/django_orm/" class="article-date">
  <time datetime="2020-04-18T02:19:20.000Z" itemprop="datePublished">2020-04-18</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="Django模型之ORM操作"><a href="#Django模型之ORM操作" class="headerlink" title="Django模型之ORM操作"></a>Django模型之ORM操作</h3><h4 id="ORM介绍"><a href="#ORM介绍" class="headerlink" title="ORM介绍"></a>ORM介绍</h4><ul>
<li><p><strong>什么是ORM</strong><br>ORM 全拼Object-Relation Mapping.</p>
<p>中文意为 对象-关系映射.</p>
<p>在MVC/MVT设计模式中的Model模块中都包括ORM</p>
</li>
<li><p><strong>ORM优势</strong></p>
<ul>
<li><p>只需要面向对象编程, 不需要面向数据库编写代码.</p>
<p>对数据库的操作都转化成对类属性和方法的操作.<br>不用编写各种数据库的sql语句.</p>
</li>
<li><p>实现了数据模型与数据库的解耦, 屏蔽了不同数据库操作上的差异.</p>
<p>不在关注用的是mysql、oracle…等.<br>通过简单的配置就可以轻松更换数据库, 而不需要修改代码.</p>
</li>
</ul>
</li>
<li><p><strong>ORM劣势</strong><br>相比较直接使用SQL语句操作数据库,有性能损失.<br>根据对象的操作转换成SQL语句,根据查询的结果转化成对象, 在映射过程中有性能损失.</p>
</li>
<li><p><strong>ORM和数据库关系：</strong><br>在Django中model是你数据的单一、明确的信息来源。它包含了你存储的数据的重要字段和行为。通常，一个模型（model）映射到一个数据库表.</p>
<p>基本情况：</p>
<p>每个模型都是一个Python类，它是django.db.models.Model的子类。</p>
<p>模型的每个属性都代表一个数据库字段。</p>
</li>
</ul>
<h4 id="ORM操作"><a href="#ORM操作" class="headerlink" title="ORM操作"></a>ORM操作</h4><p><strong>增加操作</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过python manage.py shell 进入到shell下</span></span><br><span class="line"><span class="comment"># 进入shell环境以后，首先导入模型</span></span><br><span class="line"><span class="keyword">from</span> polls.models <span class="keyword">import</span> * 			<span class="comment"># 导入全部模型</span></span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone   <span class="comment"># 导入时间模块</span></span><br><span class="line"><span class="comment"># 创建方法一：</span></span><br><span class="line">q = Question(question_text=<span class="string">"什么地方的菜最有特色？"</span>, pub_date=timezone.now())</span><br><span class="line">q.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关联创建，用问题关联创建选项</span></span><br><span class="line">q.choice_set.create(choice_text=<span class="string">"湖南"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建方法二：</span></span><br><span class="line">q = Question()          <span class="comment"># 创建实例对象</span></span><br><span class="line">q.question_text = <span class="string">"什么地方的菜最有特色？"</span></span><br><span class="line">q.pub_date = timeaone.now()</span><br><span class="line">q.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建方法三：</span></span><br><span class="line">Question.objects.create(question_text=<span class="string">"什么地方的菜最有特色？"</span>, </span><br><span class="line">                        pub_date=timezone.now())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量创建，可以提高性能，减少对数据库的访问写入次数</span></span><br><span class="line">bulk_create()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量添加，需要传入的参数是一个列表</span></span><br><span class="line">Question.objects.bulk_create(</span><br><span class="line">    [</span><br><span class="line">        Question(question_text=<span class="string">"什么地方的菜最有特色？"</span>, pub_date=timezone.now()),</span><br><span class="line">        Question(question_text=<span class="string">"什么地方的景色最美？"</span>, pub_date=timezone.now())，</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改方法1：</span></span><br><span class="line">Question.objects.filter(pk=<span class="number">1</span>).update(question_text = <span class="string">"什么地方最好玩？"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除：(先查询到某个queryset对象，然后用删除命令)</span></span><br><span class="line">q = Question.objects.get(id=<span class="number">1</span>)</span><br><span class="line">q.delete()</span><br></pre></td></tr></table></figure>

<h4 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h4><p><strong>必会的方法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、 all():                 查询所有结果</span></span><br><span class="line">question_list = Question.objects.all()  <span class="comment"># 返回一个queryset集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、 filter(**kwargs):      它包含了与所给筛选条件相匹配的对象</span></span><br><span class="line">question_list = Question.objects.filter(pk=<span class="number">1</span>)  <span class="comment"># 返回一个queryset集合,如果没有查询到，返回一个空集合,不会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、 get(**kwargs):         返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的							  对象超过一个或者没有都会抛出错误。</span></span><br><span class="line">question = Question.objects.get(pk=<span class="number">1</span>)  <span class="comment"># 返回一个queryset对象，并且只会得到一个数据，如果没有查询到，会报DoesNotExist的错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、 exclude(**kwargs):     它包含了与所给筛选条件不匹配的对象</span></span><br><span class="line">question = Question.objects.exclude(id__in=<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>])  <span class="comment"># 筛选id除了11，22，33外的，其它的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、 values(*field):        返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列                              model的实例化对象，而是一个可迭代的字典序列</span></span><br><span class="line">question = Question.objects.values()</span><br><span class="line"><span class="comment"># 返回结果：[&#123;"id": 1, "question_name": "xxxxxxx"&#125;, &#123;"id": 2, "question_name": "xxxxxxx"&#125;, ...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、 values_list(*field):   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序							   列</span></span><br><span class="line">question = Question.objects.values_list()</span><br><span class="line"><span class="comment"># 返回结果：[(1, "xxxxxxx"), (2, "xxxxxxx"), ....]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、 order_by(*field):      对查询结果排序</span></span><br><span class="line">user_list = User.objects.order_by(<span class="string">"-id"</span>)  <span class="comment"># “-” 按id降序排列</span></span><br><span class="line">user_list = User.objects.order_by()  <span class="comment"># 按id升序排列（默认）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、 reverse():             对查询结果反向排序，请注意reverse()通常只能在具有已定义顺序的QuerySet								上调用(在model类的Meta中指定ordering或调用order_by()方法)。</span></span><br><span class="line">user = User.objects.all().reverse()  <span class="comment"># 把查询的结果进行反转</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9、 distinct():            从返回结果中剔除重复纪录(如果你查询跨越多个表，可能在计算QuerySet时得到							 重复的结果。此时可以使用distinct()，注意只有在PostgreSQL中支持按字段							  去重。)</span></span><br><span class="line">Question.objects.all().distinct()  <span class="comment"># 把结果中重复的记录剔除</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10、 count():              返回数据库中匹配查询(QuerySet)的对象数量。</span></span><br><span class="line">user_count = User.objects.count()  <span class="comment"># 返回user表中的用户数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11、 first():              返回第一条记录</span></span><br><span class="line">User.objects.first()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12、 last():               返回最后一条记录</span></span><br><span class="line">User.objects.last()    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 13、 exists():             如果QuerySet包含数据，就返回True，否则返回False</span></span><br><span class="line">user = User.objects.filter(pk=<span class="number">1</span>).exists()  <span class="comment"># 返回True 或者False</span></span><br><span class="line"><span class="keyword">if</span> user:</span><br><span class="line">    print(<span class="string">"OK"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="查询条件"><a href="#查询条件" class="headerlink" title="查询条件"></a>查询条件</h3><p><strong>在 ORM 层面，这些查询条件都是使用 field + __ + condition 的方式来使用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 精确的 等于,如果提供一个None,SQL解析为Null</span></span><br><span class="line">article = Article.objects.get(id__exact=<span class="number">14</span>)</span><br><span class="line">article = Article.objects.get(id__exact=<span class="literal">None</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">对应sql</span></span><br><span class="line"><span class="string">select ... from article where id=14;</span></span><br><span class="line"><span class="string">select ... from article where id IS NULL;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># iexact 使用like查询</span></span><br><span class="line">article = Article.objects.filter(title__iexact=<span class="string">'hello world'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于 select ... from article where title like 'hello world'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 包含:contains,区分大小写</span></span><br><span class="line">articles = Article.objects.filter(title__contains=<span class="string">'hello'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于select ... where title like binary '%hello%';</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># icontains 忽略大小写</span></span><br><span class="line">articles = Article.objects.filter(title__icontains=<span class="string">'hello'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于 select ... where title like '%hello%';</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># in 提取那些给定的field的值是否在给定的容器中。容器可以为list、tuple或者任何一个可以迭代的对</span></span><br><span class="line">象，<span class="comment"># 包括QuerySet对象</span></span><br><span class="line">articles = Article.objects.filter(id__in=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于 select ... where id in (1,3,4)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># 当然也可以传递一个QuerySet对象进去。示例代码如下：</span></span><br><span class="line">inner_qs = Article.objects.filter(title__contains=<span class="string">'hello'</span>)</span><br><span class="line">categories = Category.objects.filter(article__in=inner_qs)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于:以上代码的意思是获取那些文章标题包含hello的所有分类。</span></span><br><span class="line"><span class="string">select ...from category where article.id in (select id from article where title</span></span><br><span class="line"><span class="string">like '%hello%');</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># gt 大于</span></span><br><span class="line">articles = Article.objects.filter(id__gt=<span class="number">4</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于 select ... where id &gt; 4;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># gte 大于等于</span></span><br><span class="line"><span class="comment"># lt 小于</span></span><br><span class="line"><span class="comment"># lte 小于等于</span></span><br><span class="line"><span class="comment"># startswidth 开始,大小写敏感</span></span><br><span class="line">articles = Article.objects.filter(title__startswith=<span class="string">'hello'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于: select ... where title like 'hello%'</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># istartswidth 大小写不敏感</span></span><br><span class="line"><span class="comment"># endswidth 以**结尾,大小写敏感</span></span><br><span class="line">articles = Article.objects.filter(title__endswith=<span class="string">'world'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于:select ... where title like '%world';</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># iendswidht 以**结尾,忽略大小写</span></span><br><span class="line"><span class="comment"># range 判断某个field的值是否在给定的区间中, 两个范围之间</span></span><br><span class="line"><span class="keyword">from</span> django.utils.timezone <span class="keyword">import</span> make_aware</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">start_date = make_aware(datetime(year=<span class="number">2018</span>,month=<span class="number">1</span>,day=<span class="number">1</span>))</span><br><span class="line">end_date = make_aware(datetime(year=<span class="number">2018</span>,month=<span class="number">3</span>,day=<span class="number">29</span>,hour=<span class="number">16</span>))</span><br><span class="line">articles = Article.objects.filter(pub_date__range=(start_date,end_date))</span><br><span class="line"><span class="comment"># isnull</span></span><br><span class="line">articles = Article.objects.filter(pub_date__isnull=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># regex和iregex： 正则</span></span><br><span class="line">articles = Article.objects.filter(title__regex=<span class="string">r'^hello'</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价:select ... where title regexp binary '^hello';</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">以上代码的意思是提取所有发布时间在2018/1/1到2018/12/12之间的文章。</span></span><br><span class="line"><span class="string">将翻译成以下的SQL语句：</span></span><br><span class="line"><span class="string">select ... from article where pub_time between '2018-01-01' and '2018-12-12'。</span></span><br><span class="line"><span class="string">需要注意的是，以上提取数据，不会包含最后一个值。也就是不会包含2018/12/12的文章。</span></span><br><span class="line"><span class="string">而且另外一个重点，因为我们在settings.py中指定了USE_TZ=True，并且设置了</span></span><br><span class="line"><span class="string">TIME_ZONE='Asia/Shanghai'，因此我们在提取数据的时候要使用django.utils.timezone.make_aware</span></span><br><span class="line"><span class="string">先将datetime.datetime从navie时间转换为aware时间。make_aware会将指定的时间转换为TIME_ZONE中</span></span><br><span class="line"><span class="string">指定的时区的时间。</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>



<h3 id="根据关联的表查"><a href="#根据关联的表查" class="headerlink" title="根据关联的表查"></a>根据关联的表查</h3><p><strong>假如现在有两个 ORM 模型，一个是 Article ，一个是 Category 。代码如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""文章分类表"""</span></span><br><span class="line">  name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""文章表"""</span></span><br><span class="line">  title = models.CharField(max_length=<span class="number">100</span>,null=<span class="literal">True</span>)</span><br><span class="line">  category = models.ForeignKey(<span class="string">"Category"</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>

<p><strong>比如想要获取文章标题中包含”hello”的所有的分类。那么可以通过以下代码来实现：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">categories = Category.object.filter(article__title__contains(<span class="string">"hello"</span>))</span><br></pre></td></tr></table></figure>



<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p><strong>聚合函数是通过 aggregate 方法来实现的。</strong></p>
<ul>
<li><p><strong>Avg ：求平均值。比如想要获取所有图书的价格平均值。那么可以使用以下代码实现</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg</span><br><span class="line">result = Book.objects.aggregate(Avg(<span class="string">'price'</span>))</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>以上的打印结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;price__avg&quot;:23.0&#125;</span><br></pre></td></tr></table></figure>

<p>其中 price__avg 的结构是根据 field__avg 规则构成的。如果想要修改默认的名字，那么可以将 Avg 赋值<br>给一个关键字参数。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg</span><br><span class="line">result = Book.objects.aggregate(my_avg=Avg(<span class="string">'price'</span>))</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>那么以上的结果打印为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"my_avg"</span>:<span class="number">23</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Count ：获取指定的对象的个数。示例代码如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Count</span><br><span class="line">result = Book.objects.aggregate(book_num=Count(<span class="string">'id'</span>))</span><br></pre></td></tr></table></figure>

<p>以上的 result 将返回 Book 表中总共有多少本图书。  Count 类中，还有另外一个参数叫做 distinct ，默<br>认是等于 False ，如果是等于 True ，那么将去掉那些重复的值。比如要获取作者表中所有的不重复的邮箱<br>总共有多少个，那么可以通过以下代码来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> djang.db.models <span class="keyword">import</span> Count</span><br><span class="line">result = Author.objects.aggregate(count=Count(<span class="string">'email'</span>,distinct=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Max 和 Min ：获取指定对象的最大值和最小值。比如想要获取 Author 表中，最大的年龄和最小的年龄分别</strong><br><strong>是多少。那么可以通过以下代码来实现：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Max,Min</span><br><span class="line">result = Author.objects.aggregate(Max(<span class="string">'age'</span>),Min(<span class="string">'age'</span>))</span><br></pre></td></tr></table></figure>

<p>如果最大的年龄是88,最小的年龄是18。那么以上的result将为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"age__max"</span>:<span class="number">88</span>,<span class="string">"age__min"</span>:<span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Sum ：求指定对象的总和。比如要求图书的销售总额。那么可以使用以下代码实现：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> djang.db.models <span class="keyword">import</span> Sum</span><br><span class="line">result =</span><br><span class="line">Book.objects.annotate(total=Sum(<span class="string">"bookstore__price"</span>)).values(<span class="string">"name"</span>,<span class="string">"total"</span>)</span><br></pre></td></tr></table></figure>

<p>以上的代码 annotate 的意思是给 Book 表在查询的时候添加一个字段叫做 total ，这个字段的数据来源是<br>从 BookStore 模型的 price 的总和而来。 values 方法是只提取 name 和 total 两个字段的值。</p>
<p>更多的聚合函数请参考官方文档：<a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/#aggregation-functions" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.0/ref/models/querysets/#aggregation-functions</a></p>
</li>
</ul>
<h3 id="aggregate和annotate的区别："><a href="#aggregate和annotate的区别：" class="headerlink" title="aggregate和annotate的区别："></a>aggregate和annotate的区别：</h3><ul>
<li>aggregate ：返回使用聚合函数后的字段和值。</li>
<li>annotate ：在原来模型字段的基础之上添加一个使用了聚合函数的字段，并且在使用聚合函数的时候，会<br>使用当前这个模型的主键进行分组（group by）。 比如以上 Sum 的例子，如果使用的是 annotate ，那么将<br>在每条图书的数据上都添加一个字段叫做 total ，计算这本书的销售总额。 而如果使用的是 aggregate ，<br>那么将求所有图书的销售总额。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""作者模型"""</span></span><br><span class="line">  name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">  age = models.IntegerField()</span><br><span class="line">  email = models.EmailField()</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">'author'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""出版社模型"""</span></span><br><span class="line">  name = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">'publisher'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""图书模型"""</span></span><br><span class="line">  name = models.CharField(max_length=<span class="number">300</span>)</span><br><span class="line">  pages = models.IntegerField()</span><br><span class="line">  price = models.FloatField()</span><br><span class="line">  rating = models.FloatField()</span><br><span class="line">  author = models.ForeignKey(Author,on_delete=models.CASCADE)</span><br><span class="line">  publisher = models.ForeignKey(Publisher, on_delete=models.CASCADE)</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">'book'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookOrder</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">  <span class="string">"""图书订单模型"""</span></span><br><span class="line">  book = models.ForeignKey(<span class="string">"Book"</span>,on_delete=models.CASCADE)</span><br><span class="line">  price = models.FloatField()</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    db_table = <span class="string">'book_order'</span></span><br></pre></td></tr></table></figure>



<h3 id="F表达式和Q表达式："><a href="#F表达式和Q表达式：" class="headerlink" title="F表达式和Q表达式："></a>F表达式和Q表达式：</h3><h4 id="F表达式："><a href="#F表达式：" class="headerlink" title="F表达式："></a>F表达式：</h4><p>F表达式 是用来优化 ORM 操作数据库的。比如我们要将公司所有员工的薪水都增加1000元，如果按照正常的流<br>程，应该是先从数据库中提取所有的员工工资到Python内存中，然后使用Python代码在员工工资的基础之上增加<br>1000元，最后再保存到数据库中。这里面涉及的流程就是，首先从数据库中提取数据到Python内存中，然后在<br>Python内存中做完运算，之后再保存到数据库中。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">employees = Employee.objects.all()</span><br><span class="line"><span class="keyword">for</span> employee <span class="keyword">in</span> employees:</span><br><span class="line">  employee.salary += <span class="number">1000</span></span><br><span class="line">  employee.save()</span><br></pre></td></tr></table></figure>

<p>而我们的 F表达式 就可以优化这个流程，他可以不需要先把数据从数据库中提取出来，计算完成后再保存回去，他可以直接执行 SQL语句 ，就将员工的工资增加1000元。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> djang.db.models <span class="keyword">import</span> F</span><br><span class="line">Employee.object.update(salary=F(<span class="string">"salary"</span>)+<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># 直接把sql传输到数据库!!!!!</span></span><br></pre></td></tr></table></figure>

<p>F表达式 并不会马上从数据库中获取数据，而是在生成 SQL 语句的时候，动态的获取传给 F表达式 的值。<br>比如如果想要获取作者中， name 和 email 相同的作者数据。如果不使用 F表达式 ，那么需要使用以下代码来完<br>成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">authors = Author.objects.all()</span><br><span class="line"><span class="keyword">for</span> author <span class="keyword">in</span> authors:</span><br><span class="line">	<span class="keyword">if</span> author.name == author.email:</span><br><span class="line">   		print(author)</span><br></pre></td></tr></table></figure>

<p>如果使用 F表达式 ，那么一行代码就可以搞定。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">authors = Author.objects.filter(name=F(<span class="string">"email"</span>))</span><br><span class="line"><span class="comment"># where  email = name</span></span><br></pre></td></tr></table></figure>

<h4 id="Q表达式："><a href="#Q表达式：" class="headerlink" title="Q表达式："></a>Q表达式：</h4><p>如果想要实现所有价格高于100元，并且评分达到9.0以上评分的图书。那么可以通过以下代码来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">books = Book.objects.filter(price__gte=<span class="number">100</span>,rating__gte=<span class="number">9</span>)</span><br></pre></td></tr></table></figure>

<p>以上这个案例是一个并集查询，可以简单的通过传递多个条件进去来实现。 但是如果想要实现一些复杂的查询语<br>句，比如要查询所有价格低于10元，或者是评分低于9分的图书。那就没有办法通过传递多个条件进去实现了。这<br>时候就需要使用 Q表达式 来实现了。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">books = Book.objects.filter(Q(price__lte=<span class="number">10</span>) | Q(rating__lte=<span class="number">9</span>))</span><br></pre></td></tr></table></figure>

<p>以上是进行或运算，当然还可以进行其他的运算，比如有 &amp; 和 ~（非） 等。一些用 Q 表达式的例子如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment"># 获取id等于3的图书</span></span><br><span class="line">books = Book.objects.filter(Q(id=<span class="number">3</span>))</span><br><span class="line"><span class="comment"># 获取id等于3，或者名字中包含文字"记"的图书</span></span><br><span class="line">books = Book.objects.filter(Q(id=<span class="number">3</span>)|Q(name__contains(<span class="string">"记"</span>)))</span><br><span class="line"><span class="comment"># 获取价格大于100，并且书名中包含"记"的图书</span></span><br><span class="line">books = Book.objects.filter(Q(price__gte=<span class="number">100</span>)&amp;Q(name__contains(<span class="string">"记"</span>)))</span><br><span class="line"><span class="comment"># 获取书名包含“记”，但是id不等于3的图书</span></span><br><span class="line">books = Book.objects.filter(Q(name__contains=<span class="string">'记'</span>) &amp; ~Q(id=<span class="number">3</span>))</span><br></pre></td></tr></table></figure>



<h3 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data</span></span><br><span class="line">针对某些date或者datetime类型的字段。可以指定date的范围。并且这个时间过滤，还可以使用链式调用。示</span><br><span class="line">例代码如下：</span><br><span class="line">articles = Article.objects.filter(pub_date__date=date(<span class="number">2018</span>,<span class="number">3</span>,<span class="number">29</span>))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">以上代码的意思是查找时间为2018/3/29这一天发表的所有文章。</span></span><br><span class="line"><span class="string">将翻译成以下的sql语句：</span></span><br><span class="line"><span class="string">select ... WHERE DATE(CONVERT_TZ(`front_article`.`pub_date`, 'UTC',</span></span><br><span class="line"><span class="string">'Asia/Shanghai')) = 2018-03-29</span></span><br><span class="line"><span class="string">注意，因为默认情况下MySQL的表中是没有存储时区相关的信息的。因此我们需要下载一些时区表的文件，然后添</span></span><br><span class="line"><span class="string">加到Mysql的配置路径中。如果你用的是windows操作系统。那么在</span></span><br><span class="line"><span class="string">http://dev.mysql.com/downloads/timezones.html下载timezone_2018d_posix.zip - POSIX</span></span><br><span class="line"><span class="string">standard。然后将下载下来的所有文件拷贝到C:\ProgramData\MySQL\MySQL Server 5.7\Data\mysql</span></span><br><span class="line"><span class="string">中，如果提示文件名重复，那么选择覆盖即可。</span></span><br><span class="line"><span class="string">如果用的是linux或者mac系统，那么在命令行中执行以下命令：mysql_tzinfo_to_sql</span></span><br><span class="line"><span class="string">/usr/share/zoneinfo | mysql -D mysql -u root -p，然后输入密码，从系统中加载时区文件更新到</span></span><br><span class="line"><span class="string">mysql中。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># year 根据年份进行查找</span></span><br><span class="line">articles = Article.objects.filter(pub_date__year=<span class="number">2018</span>)</span><br><span class="line">articles = Article.objects.filter(pub_date__year__gte=<span class="number">2017</span>)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">等价于:</span></span><br><span class="line"><span class="string">select ... where pub_date between '2018-01-01' and '2018-12-31';</span></span><br><span class="line"><span class="string">select ... where pub_date &gt;= '2017-01-01';</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># month 同year,根据月份查</span></span><br><span class="line"><span class="comment"># day  同year,根据日期查</span></span><br><span class="line"><span class="comment"># week_day Django 1.11新增的查找方式。同year，根据星期几进行查找。1表示星期天，7表示星期六，2-6代表的是星期一到星期五。</span></span><br><span class="line"><span class="comment"># time 根据时间查</span></span><br><span class="line">articles = Article.objects.filter(pub_date__time=datetime.time(<span class="number">12</span>,<span class="number">12</span>,<span class="number">12</span>));</span><br></pre></td></tr></table></figure>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-django_virtualenv" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/17/django_virtualenv/"
    >Django--创建虚拟环境</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/17/django_virtualenv/" class="article-date">
  <time datetime="2020-04-16T17:08:22.000Z" itemprop="datePublished">2020-04-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h1 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h1><h3 id="为什么需要虚拟环境："><a href="#为什么需要虚拟环境：" class="headerlink" title="为什么需要虚拟环境："></a>为什么需要虚拟环境：</h3><p>到目前位置，我们所有的第三方包安装都是直接通过<code>pip install xx</code>的方式进行安装的，这样安装会将那个包安装到你的系统级的<code>Python</code>环境中。但是这样有一个问题，就是如果你现在用<code>Django 1.18.x</code>写了个网站，然后你的领导跟你说，之前有一个旧项目是用<code>Django 2.1.x</code>开发的，让你来维护，但是<code>Django 1.18.x</code>不再兼容<code>Django 2.1.x</code>的一些语法了。这时候就会碰到一个问题，我如何在我的电脑中同时拥有<code>Django 1.18.x</code>和<code>Django 2.1.x</code>两套环境呢？这时候我们就可以通过虚拟环境来解决这个问题。</p>
<h3 id="虚拟环境原理介绍："><a href="#虚拟环境原理介绍：" class="headerlink" title="虚拟环境原理介绍："></a>虚拟环境原理介绍：</h3><p>虚拟环境相当于一个抽屉，在这个抽屉中安装的任何软件包都不会影响到其他抽屉。并且在项目中，我可以指定这个项目的虚拟环境来配合我的项目。比如我们现在有一个项目是基于<code>Django 1.18.x</code>版本，又有一个项目是基于<code>Django 2.1.x</code>的版本，那么这时候就可以创建两个虚拟环境，在这两个虚拟环境中分别安装<code>Django 1.18.x</code>和<code>Django 2.1.x</code>来适配我们的项目。</p>
<h3 id="安装virtualenv："><a href="#安装virtualenv：" class="headerlink" title="安装virtualenv："></a>安装<code>virtualenv</code>：</h3><p><code>virtualenv</code>是用来创建虚拟环境的软件工具，我们可以通过<code>pip</code>或者<code>pip3</code>来安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">pip3 install virtualenv  # 一般在linux下用这个命令</span><br><span class="line">pip install virtualenvwrapper-win</span><br></pre></td></tr></table></figure>

<h3 id="创建虚拟环境："><a href="#创建虚拟环境：" class="headerlink" title="创建虚拟环境："></a>创建虚拟环境：</h3><p>创建虚拟环境非常简单，通过以下命令就可以创建了：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkvirtualenv [虚拟环境的名字]</span></span><br><span class="line">mkvirtualenv py_dj2</span><br></pre></td></tr></table></figure>

<p>如果你当前的<code>Python3/Scripts</code>的查找路径在<code>Python2/Scripts</code>的前面，那么将会使用<code>python3</code>作为这个虚拟环境的解释器。如果<code>python2/Scripts</code>在<code>python3/Scripts</code>前面，那么将会使用<code>Python2</code>来作为这个虚拟环境的解释器。</p>
<h3 id="进入环境："><a href="#进入环境：" class="headerlink" title="进入环境："></a>进入环境：</h3><p>虚拟环境创建好了以后，那么可以进入到这个虚拟环境中，然后安装一些第三方包，进入虚拟环境在不同的操作系统中有不同的方式，一般分为两种，第一种是<code>Windows</code>，第二种是<code>Linux</code>：</p>
<ol>
<li><code>windows</code>进入虚拟环境：进入到虚拟环境的<code>Scripts</code>文件夹中，然后执行workon py_dj2。</li>
<li><code>Linux</code>进入虚拟环境：<code>source /path/to/virtualenv/bin/activate</code><br>一旦你进入到了这个虚拟环境中，你安装包，卸载包都是在这个虚拟环境中，不会影响到外面的环境。</li>
</ol>
<h3 id="退出虚拟环境："><a href="#退出虚拟环境：" class="headerlink" title="退出虚拟环境："></a>退出虚拟环境：</h3><p>退出虚拟环境很简单，通过一个命令就可以完成：<code>deactivate</code>。</p>
<h3 id="virtualenvwrapper："><a href="#virtualenvwrapper：" class="headerlink" title="virtualenvwrapper："></a>virtualenvwrapper：</h3><p><code>virtualenvwrapper</code>这个软件包可以让我们管理虚拟环境变得更加简单。不用再跑到某个目录下通过<code>virtualenv</code>来创建虚拟环境，并且激活的时候也要跑到具体的目录下去激活。</p>
<h4 id="安装virtualenvwrapper："><a href="#安装virtualenvwrapper：" class="headerlink" title="安装virtualenvwrapper："></a>安装<code>virtualenvwrapper</code>：</h4><ol>
<li>Linux：<code>pip install virtualenvwrapper</code>。</li>
<li>windows：<code>pip install virtualenvwrapper-win</code>。</li>
</ol>
<h4 id="virtualenvwrapper基本使用："><a href="#virtualenvwrapper基本使用：" class="headerlink" title="virtualenvwrapper基本使用："></a><code>virtualenvwrapper</code>基本使用：</h4><ol>
<li>创建虚拟环境：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv my_env</span><br></pre></td></tr></table></figure>

<p>   那么会在你当前用户下创建一个<code>Env</code>的文件夹，然后将这个虚拟环境安装到这个目录下。<br>   如果你电脑中安装了<code>python2</code>和<code>python3</code>，并且两个版本中都安装了<code>virtualenvwrapper</code>，那么将会使用环境变量中第一个出现的<code>Python</code>版本来作为这个虚拟环境的<code>Python</code>解释器。</p>
<ol start="2">
<li>切换到某个虚拟环境：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workon my_env</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>退出当前虚拟环境：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除某个虚拟环境：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmvirtualenv my_env</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>列出所有虚拟环境：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsvirtualenv</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>创建虚拟环境的时候指定<code>Python</code>版本：</li>
</ol>
<p>在使用<code>mkvirtualenv</code>的时候，可以指定<code>--python</code>的参数来指定具体的<code>python</code>路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv --python&#x3D;&#x3D;C:\Python36\python.exe hy_env</span><br></pre></td></tr></table></figure>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/" rel="tag">Django</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2019-2020
        <i class="ri-heart-fill heart_icon"></i> Mr.L
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">HOME</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">ARCHIVE</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about/">ABOUT</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Subtitle -->

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->


    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
        
    


<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->


<script src="/js/clickLove.js"></script>


<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>



    
  </div>
</body>

</html>